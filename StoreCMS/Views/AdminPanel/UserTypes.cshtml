@model UserType[]
@using Microsoft.AspNetCore.Html;
@inject IUserTypesLocalization localization
@{
    Layout = "CommonPage";
    User user = Context.Items["User"] as User;
    Context.Items["PageName"] = localization.PageName;
    Context.Items["PageStyle"] = "/styles/admin_panel/user_types.css";
    List<IHtmlContent> accessLevels = new List<IHtmlContent>()
    {
        Html.Raw($"1 - {localization.VeryLowAccessLevel}"),
        Html.Raw($"2 - {localization.LowAccessLevel}"),
        Html.Raw($"3 - {localization.MiddleAccessLevel}"),
        Html.Raw($"4 - {localization.HighAccessLevel}"),
        Html.Raw($"5 - {localization.VeryHighAccessLevel}")
    };
}
<script src="/scripts/admin_panel/send_data.js"></script>
                <script>
                    function error() {
                        alert('@Html.Raw(localization.RequestCannotBeCompleted)');
                    }
                    function successfullyEdited() {
                        alert('@Html.Raw(localization.UserTypeEdited)');
                        location.reload();
                    }
                    function successfullyDeleted() {
                        alert('@Html.Raw(localization.UserTypeDeleted)');
                        location.reload();
                    }
                    </script>
@if (SecurityFunctions.HasAccessTo(AdminPanelPages.AddUserType, user, Context))
{
                    <form id="add-user-type-form" class="container">
                        <div class="user-type-name">
                            <label for="user-type">@Html.Raw(localization.UserTypeName)</label>
                            <input type="text" id="user-type" name="UserTypeModel.Name">
                        </div>
                        <div class="access-level">
                            <label for="access-level">@Html.Raw(localization.AccessLevel)</label>
                            <select id="access-level" name="UserTypeModel.AccessLevel">
                                @for(int i = 1; i <= accessLevels.Count - 1; ++i)
                                {
                                <option value="@i">@accessLevels[i-1]</option>
                                }
                                <option value="@(accessLevels.Count)" selected>@accessLevels[accessLevels.Count - 1]</option>
                            </select>
                        </div>
                        <div class="action">
                            <input type="submit" id="add-user-type-button" value="@Html.Raw(localization.Add)">
                        </div>
                    </form>
                    <script>
                        function successfullyAdded() {
                            alert('@Html.Raw(localization.UserTypeAdded)');
                            location.reload();
                        }
                        let addSubmit = document.getElementById('add-user-type-button');
                        addSubmit.addEventListener('click', createSendDataEventHandler('POST', '?pageID=@((int)AdminPanelPages.AddUserType)', 'add-user-type-form', successfullyAdded, error));
                    </script>
}
@foreach (var userType in Model)
{
                    <form id="user-type-@userType.ID" class="container">
                        <input type="hidden" name="itemID" value="@userType.ID">
                        <div class="user-type-name">
                            <label for="user-type-@userType.ID">@Html.Raw(localization.UserTypeName)</label>
                            <input type="text" id="user-type-@userType.ID" name="UserTypeModel.Name" value="@userType.Name">
                        </div>
                        <div class="access-level">
                            <label for="access-level-@userType.ID">@Html.Raw(localization.AccessLevel)</label>
                            <select id="access-level" name="UserTypeModel.AccessLevel" @(userType.ID == 1 ? "disabled" : string.Empty)>
                                @for (int i = 1; i <= accessLevels.Count; ++i)
                                {
                                    if ((int)userType.AccessLevel == i)
                                    {
                                <option value="@i" selected>@accessLevels[i - 1]</option>
                                    }
                                    else
                                    {
                                <option value="@i">@accessLevels[i - 1]</option>
                                    }
                                }
                            </select>
                        </div>
                        <div class="actions">
            @if (SecurityFunctions.HasAccessTo(AdminPanelPages.EditUserType, user, Context))
            {
                            <input type="submit" id="edit-user-type-button-@userType.ID" value="@Html.Raw(localization.Edit)">
                            <script>
                                let editButton_@(userType.ID) = document.getElementById('edit-user-type-button-@(userType.ID)');
                                editButton_@(userType.ID).addEventListener('click', createSendDataEventHandler('POST', '?pageID=@((int)AdminPanelPages.EditUserType)', 'user-type-@(userType.ID)', successfullyEdited, error));
                            </script>         
            }
            else
            {
                            <input type="submit" value="@Html.Raw(localization.Edit)" disabled>
            }
            @if (SecurityFunctions.HasAccessTo(AdminPanelPages.DeleteUserType, user, Context) && userType.ID > 1)
            {
            <input type="submit" id="delete-user-type-button-@userType.ID" value="@Html.Raw(localization.Delete)">
                <script>
                        let deleteButton_@(userType.ID) = document.getElementById('delete-user-type-button-@(userType.ID)');
                        deleteButton_@(userType.ID).addEventListener('click', createSendDataEventHandler('DELETE', '?pageID=@((int)AdminPanelPages.DeleteUserType)', 'user-type-@(userType.ID)', successfullyDeleted, error));
                </script>
            }
            else
            {
                            <input type="submit" value="@Html.Raw(localization.Delete)" disabled>
            }
                        </div>
                    </form>
}